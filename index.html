<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Get Contact ‚Äî Demo</title>
<style>
  :root{--bg:#0b1220;--card:#0f1724;--accent:#06b6d4;--muted:#9aa6b2}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Arial;background:linear-gradient(180deg,var(--bg),#071023);color:#e6eef8;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:18px}
  .card{width:100%;max-width:720px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.06));padding:20px;border-radius:12px;box-shadow:0 10px 30px rgba(2,6,23,.6)}
  h1{margin:0 0 8px;font-size:20px;color:var(--accent)}
  p{margin:0 0 14px;color:var(--muted)}
  .row{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
  button{background:var(--accent);color:#062024;border:0;padding:10px 12px;border-radius:10px;cursor:pointer;font-weight:600}
  button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
  .contacts{display:grid;gap:10px}
  .contact{display:flex;justify-content:space-between;align-items:center;padding:12px;border-radius:10px;background:rgba(255,255,255,0.02)}
  .meta{min-width:0}
  .name{font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .tel{color:var(--muted);font-size:13px}
  .actions{display:flex;gap:8px}
  .note{font-size:13px;color:var(--muted);margin-top:8px}
  .input-manual{display:flex;gap:8px;margin-bottom:12px}
  input[type="text"]{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
  @media(max-width:520px){h1{font-size:18px}}
</style>
</head>
<body>
  <div class="card">
    <h1>Get Contact (Demo)</h1>
    <p>Pilih kontak dari perangkat (jika didukung). Atau tambahkan nomor manual.</p>

    <div class="row">
      <button id="btnPick">üìá Pilih Kontak</button>
      <button id="btnPickMultiple" class="ghost">üìë Pilih Banyak</button>
      <button id="btnClear" class="ghost">üóëÔ∏è Bersihkan</button>
    </div>

    <div class="input-manual">
      <input id="manualName" type="text" placeholder="Nama (manual)"/>
      <input id="manualTel" type="text" placeholder="Nomor (contoh: 628123456789)"/>
      <button id="btnAdd">‚ûï Tambah</button>
    </div>

    <div class="contacts" id="contactsList">
      <!-- kontak muncul di sini -->
    </div>

    <div class="note">
      Note: Contact Picker API hanya didukung di beberapa browser Android (Chrome/Edge). Jika tombol "Pilih Kontak" tidak bekerja, gunakan input manual.
    </div>
  </div>

<script>
  const btnPick = document.getElementById('btnPick');
  const btnPickMultiple = document.getElementById('btnPickMultiple');
  const btnClear = document.getElementById('btnClear');
  const contactsList = document.getElementById('contactsList');
  const btnAdd = document.getElementById('btnAdd');

  // Array menyimpan kontak yang dipilih / ditambahkan
  let contacts = [];

  // Render daftar kontak ke UI
  function render() {
    contactsList.innerHTML = '';
    contacts.forEach((c, idx) => {
      const el = document.createElement('div');
      el.className = 'contact';
      el.innerHTML = `
        <div class="meta">
          <div class="name">${escapeHtml(c.name || '‚Äî')}</div>
          <div class="tel">${escapeHtml(c.tel || '‚Äî')}</div>
        </div>
        <div class="actions">
          <button class="ghost" onclick="copyTel(${idx})">üìã Copy</button>
          <button onclick="openWA(${idx})">üí¨ WA</button>
        </div>
      `;
      contactsList.appendChild(el);
    });
  }

  // Escape HTML simple
  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, chr => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[chr])); }

  // Copy nomor
  function copyTel(i){
    const tel = contacts[i].tel || '';
    if(!tel) return alert('Nomor kosong');
    navigator.clipboard?.writeText(tel).then(()=> alert('Nomor disalin: ' + tel)).catch(()=> alert('Gagal salin'));
  }

  // Open WhatsApp with prefilled number
  function openWA(i){
    const tel = contacts[i].tel || '';
    if(!tel) return alert('Nomor kosong');
    // normalisasi: hapus spasi, +, tanda lain
    const normalized = tel.replace(/\D/g,'');
    const url = `https://wa.me/${normalized}`;
    window.open(url, '_blank');
  }

  // Clear list
  btnClear.addEventListener('click', ()=>{ contacts = []; render(); });

  // Add manual
  btnAdd.addEventListener('click', ()=>{
    const name = document.getElementById('manualName').value.trim();
    const tel = document.getElementById('manualTel').value.trim();
    if(!tel) return alert('Masukkan nomor telepon');
    contacts.push({name: name || tel, tel});
    document.getElementById('manualName').value = '';
    document.getElementById('manualTel').value = '';
    render();
  });

  // Feature detection: Contact Picker API
  const supportsContacts = !!(navigator.contacts && navigator.contacts.select);

  // Single pick
  btnPick.addEventListener('click', async ()=>{
    if(!supportsContacts){
      alert('Browser Anda tidak mendukung Contact Picker API. Gunakan input manual.');
      return;
    }
    try{
      // minta name dan tel; beberapa browser juga mendukung email
      const props = ['name','tel'];
      const opts = {multiple:false};
      const picked = await navigator.contacts.select(props, opts); // returns array
      // picked may be array of contacts
      if(picked && picked.length){
        const first = picked[0];
        // normalize name & tel
        const name = (first.name && first.name[0]) || first.name || '';
        const tel = (first.tel && first.tel[0]) || first.tel || '';
        contacts.push({name, tel});
        render();
      }
    }catch(err){
      console.error(err);
      alert('Pemilihan kontak dibatalkan atau gagal.');
    }
  });

  // Multiple pick
  btnPickMultiple.addEventListener('click', async ()=>{
    if(!supportsContacts){
      alert('Browser Anda tidak mendukung Contact Picker API. Gunakan input manual.');
      return;
    }
    try{
      const props = ['name','tel'];
      const opts = {multiple:true};
      const picked = await navigator.contacts.select(props, opts);
      if(picked && picked.length){
        for(const p of picked){
          const name = (p.name && p.name[0]) || p.name || '';
          const tel = (p.tel && p.tel[0]) || p.tel || '';
          contacts.push({name, tel});
        }
        render();
      }
    }catch(err){
      console.error(err);
      alert('Pemilihan kontak dibatalkan atau gagal.');
    }
  });

  // initial render
  render();
</script>
</body>
</html>